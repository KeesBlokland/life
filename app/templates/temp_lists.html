{% extends "base.html" %}
<!--
/home/life/app/templates/temp_lists.html
Version: 1.2.0
Purpose: Shopping list with all CSS moved to styles-shopping.css
Created: 2025-06-11
Updated: 2025-06-16 - Moved all inline CSS to separate CSS file
-->

{% block title %}Shopping Lists - Life{% endblock %}

{% block page_name %}: Shopping {% endblock %}

{% block template_info %}temp_lists.html v1.2.0 - CSS moved to separate file{% endblock %}

{% block content %}
<div class="container">
    <!-- List Tabs Only -->
    <div class="list-tabs-container">
        {% for list in available_lists %}
            {% if session.get('is_admin') or list.name == 'food' %}
            <a href="{{ url_for('main.lists', list_name=list.name) }}" 
               class="button {% if current_list.name == list.name %}button-active{% endif %}">
                {{ list.title }}
            </a>
            {% endif %}
        {% endfor %}
    </div>
    
    <!-- Add New Item Card - Compact -->
    <div class="add-item-card">
        <form method="post" action="{{ url_for('main.add_new_item') }}" class="add-item-form">
            <input type="hidden" name="list_name" value="{{ current_list.name }}">
            <input type="text" name="item" placeholder="Add new item to master list" required autofocus>
            <label class="add-today-check">
                <input type="checkbox" name="add_to_today" value="yes">
                Add to today's list
            </label>
            <button type="submit" class="button">Add Item</button>
        </form>
    </div>
    
    <!-- Two Column Layout -->
    <div class="shopping-columns">
        
        <!-- Left: Master List -->
        <div class="master-column">
            <div class="column-header">
                Items You Usually Buy
            </div>
            
            {% if master_items %}
            <div class="master-items">
                {% for item in master_items %}
                <div class="master-item clickable-item" onclick="addToToday('{{ item.item }}', '{{ current_list.name }}')">
                    <div class="item-content">
                        <span class="item-name">{{ item.item }}</span>
                        
                    </div>
                    
                    <div class="item-actions">
                        {% if session.get('is_admin') %}
                        <button type="button" 
                                class="button-sm button-danger admin-delete"
                                onclick="event.stopPropagation(); deleteItem('{{ item.item }}', '{{ current_list.name }}')"
                                title="Delete from history">
                            Del
                        </button>
                        {% endif %}
                        
                        <span class="add-hint">Click to add</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
                <div class="empty-message">
                    No items in history yet. Add items above to build your master list.
                </div>
            {% endif %}
        </div>
        
        <!-- Right: Today's List -->
        <div class="today-column">
            <div class="column-header-with-actions">
                <span>Today's Shopping List</span>
                <div class="header-actions">
                    <a href="{{ url_for('main.print_list', list_name=current_list.name) }}" 
                       target="_blank" class="button-sm button-secondary">Print</a>
                    <a href="{{ url_for('main.export_list', list_name=current_list.name) }}" 
                       class="button-sm button-secondary">Export</a>
                </div>
            </div>
            
            {% if today_items %}
                <div class="today-items">
                    {% for item in today_items %}
                    <div class="today-item">
                        <span class="today-item-name">{{ item.item }}</span>
                        
                        <div class="today-item-actions">
                            <button type="button" 
                                    class="button-sm button-danger"
                                    onclick="removeFromToday({{ item.id }}, '{{ current_list.name }}')"
                                    title="Remove from list">
                                Remove
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="today-footer">
                    <button type="button" 
                            class="button-sm button-danger"
                            onclick="clearTodayList('{{ current_list.name }}')"
                            title="Clear all items">
                        Clear Today's List
                    </button>
                </div>
            {% else %}
                <div class="empty-message">
                    No items selected for today.
                    <br>
                    Click "Add â†’" on items from the left to build your shopping list.
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Simple click-to-add functionality
function addToToday(item, listName) {
    const form = new FormData();
    form.append('item', item);
    form.append('list_name', listName);
    
    fetch('/shopping/add_to_today', {
        method: 'POST',
        body: form
    }).then(() => {
        location.reload();
    });
}

function removeFromToday(itemId, listName) {
    const form = new FormData();
    form.append('list_name', listName);
    
    fetch(`/shopping/remove_from_today/${itemId}`, {
        method: 'POST',
        body: form
    }).then(() => {
        location.reload();
    });
}

function clearTodayList(listName) {
    if (confirm('Clear all items from today\'s list?')) {
        const form = new FormData();
        form.append('list_name', listName);
        
        fetch('/shopping/clear_today', {
            method: 'POST',
            body: form
        }).then(() => {
            location.reload();
        });
    }
}

function deleteItem(item, listName) {
    if (confirm(`Delete ${item} from history?`)) {
        const form = new FormData();
        form.append('item', item);
        form.append('list_name', listName);
        
        fetch('/shopping/delete_master_item', {
            method: 'POST',
            body: form
        }).then(() => {
            location.reload();
        });
    }
}

// Hide flash messages immediately to prevent screen jumping
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.message');
    messages.forEach(function(message) {
        if (message.textContent.includes('Added') || 
            message.textContent.includes('removed') || 
            message.textContent.includes('updated')) {
            message.style.display = 'none';
        }
    });
});
</script>
{% endblock %}