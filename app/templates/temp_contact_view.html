{% extends "base.html" %}
<!--
temp_contact_view.html - Contact details view with basic and sensitive information
Version: 1.0.08
Purpose: Simple contact display matching reference design exactly - ACTUALLY FIXED
Created: 2025-06-17
Updated: 2025-06-17 - COMPLETELY REWRITTEN to match reference design
-->

{% block title %}{{ contact.name }} - Contacts - Life{% endblock %}

{% block template_info %}temp_contact_view.html v1.0.08 - Simple contact display{% endblock %}

{% block content %}
<div class="container">
    <div class="simple-contact">
        <h1>{{ contact.name }} <span class="contact-type">{{ contact.contact_type }}{% if contact.category %} - {{ contact.category }}{% endif %}</span></h1>
        
        {% for detail in details.basic %}
        <p><strong>{{ detail.field_name }}:</strong> 
        {% if 'phone' in detail.field_name|lower or 'handy' in detail.field_name|lower or 'telefon' in detail.field_name|lower %}
        <a href="tel:{{ detail.field_value }}">{{ detail.field_value }}</a>
        {% elif 'email' in detail.field_name|lower or 'e-mail' in detail.field_name|lower %}
        <a href="mailto:{{ detail.field_value }}">{{ detail.field_value }}</a>
        {% elif 'website' in detail.field_name|lower or 'url' in detail.field_name|lower %}
        <a href="{{ detail.field_value if detail.field_value.startswith('http') else 'https://' + detail.field_value }}" target="_blank">{{ detail.field_value }}</a>
        {% else %}
        {{ detail.field_value }}
        {% endif %}
        </p>
        {% endfor %}
        
        {% if details.sensitive %}
        <p><strong>Account Info:</strong> <button type="button" id="toggleSensitive" class="button button-small" onclick="toggleSensitiveInfo()">Show</button></p>
        <div id="sensitiveDetails" style="display: none;">
            {% for detail in details.sensitive %}
            <p><strong>{{ detail.field_name }}:</strong> <span class="sensitive-value" data-value="{{ detail.field_value }}">••••••••••</span> <button type="button" class="button button-small" onclick="toggleValue(this)">Show</button></p>
            {% endfor %}
        </div>
        {% endif %}
        
        {% if contact.notes %}
        <p><strong>Notes:</strong> {{ contact.notes }}</p>
        {% endif %}
        
        <p>
            {% if session.get('is_admin') %}
            <a href="{{ url_for('contacts.edit_contact', contact_id=contact.id) }}" class="button">Edit</a>
            {% else %}
            <a href="{{ url_for('contacts.request_change', contact_id=contact.id) }}" class="button">Request Changes</a>
            {% endif %}
            <a href="{{ url_for('contacts.browse') }}" class="button">Back</a>
        </p>
    </div>
</div>

<script>
function toggleSensitiveInfo() {
    const details = document.getElementById('sensitiveDetails');
    const button = document.getElementById('toggleSensitive');
    
    if (details.style.display === 'none') {
        details.style.display = 'block';
        button.textContent = 'Hide';
        setTimeout(() => {
            if (details.style.display === 'block') {
                details.style.display = 'none';
                button.textContent = 'Show';
                document.querySelectorAll('.sensitive-value').forEach(span => {
                    span.textContent = '••••••••••';
                    span.nextElementSibling.textContent = 'Show';
                });
            }
        }, 30000);
    } else {
        details.style.display = 'none';
        button.textContent = 'Show';
    }
}

function toggleValue(button) {
    const valueSpan = button.previousElementSibling;
    const actualValue = valueSpan.getAttribute('data-value');
    
    if (button.textContent === 'Show') {
        valueSpan.textContent = actualValue;
        button.textContent = 'Hide';
        setTimeout(() => {
            if (button.textContent === 'Hide') {
                valueSpan.textContent = '••••••••••';
                button.textContent = 'Show';
            }
        }, 10000);
    } else {
        valueSpan.textContent = '••••••••••';
        button.textContent = 'Show';
    }
}
</script>
{% endblock %}