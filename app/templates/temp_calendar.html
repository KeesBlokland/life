{% extends "base.html" %}
<!--
/home/life/app/templates/temp_calendar.html
Version: 1.2.2
Purpose: Simple calendar list - one line per event like documents layout
Created: 2025-06-11
Updated: 2025-06-13 - Simplified to one line per event (like documents), no more confusing grouping
-->

{% block title %}Calendar - Life{% endblock %}

{% block page_name %}: Calendar{% endblock %}

{% block template_info %}temp_calendar.html v1.2.0 - Elderly-friendly calendar list{% endblock %}

{% block content %}
<div class="container">
    <!-- Simple, clear controls -->
    <div class="calendar-controls">
        <div class="calendar-nav">
            <a href="{{ url_for('main.calendar', year=year, month=month-1 if month > 1 else 12) }}" class="button">← Last Month</a>
            <span class="calendar-period">
                {% set month_names = ['', 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'] %}
                {{ month_names[month] }} {{ year }}
            </span>
            <a href="{{ url_for('main.calendar', year=year, month=month+1 if month < 12 else 1) }}" class="button">Next Month →</a>
        </div>
        
        <div class="calendar-actions">
            <a href="{{ url_for('main.add_event') }}" class="button">Add Event</a>
            <a href="{{ url_for('main.calendar') }}" class="button button-secondary">This Month</a>
        </div>
    </div>
    
    <!-- Quick navigation -->
    <div class="quick-nav">
        <h3>Jump to:</h3>
        <div class="quick-nav-buttons">
            <a href="{{ url_for('main.calendar') }}" class="button button-small">This Month</a>
            <a href="{{ url_for('main.calendar', year=year, month=month+1 if month < 12 else 1) }}" class="button button-small">Next Month</a>
            <a href="{{ url_for('main.calendar', year=year+1, month=month) }}" class="button button-small">Next Year</a>
        </div>
    </div>
    
    <!-- Debug: Show what data we have -->
    {% if config.DEBUG %}
    <div class="debug-info">
        <small>Debug: calendar_data has {{ calendar_data|length }} weeks</small>
    </div>
    {% endif %}
    
    <!-- Events list - simple one line per event like documents -->
    {% set all_events = [] %}
    {% for week in calendar_data %}
        {% for day in week %}
            {% if day.day and day.events %}
                {% for event in day.events %}
                    {% if all_events.append({'date': day.date, 'event': event}) %}{% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    {% endfor %}
    
    {% if all_events %}
        <div class="events-list">
            {% for item in all_events %}
            <div class="event-row">
                <div class="event-line">
                    <a href="{{ url_for('main.day_view', date_str=item.date.strftime('%Y-%m-%d')) }}" class="button button-small">View Day</a>
                    <span class="event-title">{{ item.event.title }}</span>
                    <span class="event-date">{{ item.date.strftime('%a %b %d') }}</span>
                    <div class="event-actions">
                        <button onclick="showEventMenu({{ item.event.id }}, '{{ item.event.title }}', event)" class="button button-small button-secondary">⋯</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-events">
            <h3>No Events in {{ month_names[month] }}</h3>
            <p>Nothing scheduled for {{ month_names[month] }} {{ year }}.</p>
            <a href="{{ url_for('main.add_event') }}" class="button">Add Your First Event</a>
        </div>
    {% endif %}
</div>

<!-- Event context menu -->
<div id="eventMenu" class="event-menu" style="display: none;">
    <button onclick="editEvent()" class="menu-item">Edit</button>
    <button onclick="deleteEvent()" class="menu-item menu-danger">Delete</button>
    <button onclick="closeMenu()" class="menu-item">Cancel</button>
</div>

<script>
let currentEventId = null;

// Event context menu
function showEventMenu(eventId, eventTitle, event) {
    event.stopPropagation();
    currentEventId = eventId;
    
    const menu = document.getElementById('eventMenu');
    menu.style.display = 'block';
    menu.style.left = event.pageX + 'px';
    menu.style.top = event.pageY + 'px';
}

function editEvent() {
    if (currentEventId) {
        window.location.href = `/event/edit/${currentEventId}`;
    }
    closeMenu();
}

function deleteEvent() {
    if (currentEventId) {
        if (confirm('Are you sure you want to delete this event?')) {
            fetch(`/event/delete/${currentEventId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => {
                if (response.ok) {
                    location.reload();
                } else {
                    alert('Failed to delete event');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to delete event');
            });
        }
    }
    closeMenu();
}

function closeMenu() {
    document.getElementById('eventMenu').style.display = 'none';
    currentEventId = null;
}

// Close menu when clicking elsewhere
document.addEventListener('click', function(event) {
    if (!event.target.closest('.event-menu') && !event.target.closest('button[onclick*="showEventMenu"]')) {
        closeMenu();
    }
});
</script>
{% endblock %}